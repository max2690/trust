# üìÅ –°–ü–ò–°–û–ö –í–°–ï–• –§–ê–ô–õ–û–í –î–õ–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø

## üîÑ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´ (–Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

### 1. `src/lib/bot-launcher.ts`
**–ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:** `/var/www/mb-trust/src/lib/bot-launcher.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–≤–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ 409 —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
- Health check –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
- Graceful shutdown –ø—Ä–∏ SIGINT/SIGTERM
- –§—É–Ω–∫—Ü–∏—è `forceRestartBot()` –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

**–ö–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
scp src/lib/bot-launcher.ts root@109.69.58.185:/var/www/mb-trust/src/lib/bot-launcher.ts
```

---

### 2. `src/lib/telegram-init.ts`
**–ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:** `/var/www/mb-trust/src/lib/telegram-init.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- Rate limiting: –º–∞–∫—Å. 10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª–∏–Ω–∞, —Å–ø–∞–º, —Ä–µ–∫–ª–∞–º–∞, —ç–º–æ–¥–∑–∏)
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π (30 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏)
- OpenAI retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (1s, 2s, 4s)
- Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä –ø—Ä–∏ —Å–±–æ—è—Ö OpenAI
- –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π `getBotInstance()` –∏ `shutdownBot()`

**–ö–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
scp src/lib/telegram-init.ts root@109.69.58.185:/var/www/mb-trust/src/lib/telegram-init.ts
```

---

### 3. `mb-trust-production.service`
**–ü—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:** `/etc/systemd/system/mb-trust.service`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `ExecStartPost` –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ health check
- `Restart=always` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- `RestartSec=5` –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
- `TimeoutStopSec=10` –¥–ª—è graceful shutdown
- `StartLimitIntervalSec=0` –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏

**–ö–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
scp mb-trust-production.service root@109.69.58.185:/tmp/mb-trust-production.service
```

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:**
```bash
sudo cp /tmp/mb-trust-production.service /etc/systemd/system/mb-trust.service
sudo systemctl daemon-reload
```

---

## üìÑ –ù–û–í–´–ï –§–ê–ô–õ–´ (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

### 4. `PROTECTION_GUIDE.md`
–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞—â–∏—Ç, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

```bash
scp PROTECTION_GUIDE.md root@109.69.58.185:/var/www/mb-trust/
```

---

### 5. `INSTALLATION.md`
–ü–æ–ª–Ω–∞—è –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å —Ç–µ—Å—Ç–∞–º–∏.

```bash
scp INSTALLATION.md root@109.69.58.185:/var/www/mb-trust/
```

---

### 6. `QUICK_INSTALL.md`
–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏.

```bash
scp QUICK_INSTALL.md root@109.69.58.185:/var/www/mb-trust/
```

---

### 7. `FILES_LIST.md`
–≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

```bash
scp FILES_LIST.md root@109.69.58.185:/var/www/mb-trust/
```

---

## ‚ö° –ö–û–ú–ê–ù–î–´ –î–õ–Ø –ë–´–°–¢–†–û–ì–û –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø

### –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
# –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
scp src/lib/bot-launcher.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp src/lib/telegram-init.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp mb-trust-production.service root@109.69.58.185:/tmp/

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
scp PROTECTION_GUIDE.md root@109.69.58.185:/var/www/mb-trust/
scp INSTALLATION.md root@109.69.58.185:/var/www/mb-trust/
scp QUICK_INSTALL.md root@109.69.58.185:/var/www/mb-trust/
scp FILES_LIST.md root@109.69.58.185:/var/www/mb-trust/
```

---

## üîß –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô –ù–ê –°–ï–†–í–ï–†–ï

–ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å
ssh root@109.69.58.185

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ systemd unit
sudo cp /tmp/mb-trust-production.service /etc/systemd/system/mb-trust.service
sudo systemctl daemon-reload

# 3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
cd /var/www/mb-trust
npm run build

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl restart mb-trust

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
journalctl -u mb-trust -f
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –£–°–ü–ï–•–ê

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è (—á–µ—Ä–µ–∑ 5-10 —Å–µ–∫—É–Ω–¥):

```
ü§ñ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞...
‚úÖ Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω
```

–ï—Å–ª–∏ —ç—Ç–∏—Ö —Å—Ç—Ä–æ–∫ –Ω–µ—Ç:
```bash
curl http://localhost:3000/api/health
journalctl -u mb-trust -n 20
```

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ò–∑–º–µ–Ω–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: 2
- `src/lib/bot-launcher.ts` ‚Äî +145 —Å—Ç—Ä–æ–∫
- `src/lib/telegram-init.ts` ‚Äî +130 —Å—Ç—Ä–æ–∫

### –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: 5
- `mb-trust-production.service` ‚Äî –Ω–æ–≤—ã–π systemd unit
- `PROTECTION_GUIDE.md` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞—â–∏—Ç
- `INSTALLATION.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `QUICK_INSTALL.md` ‚Äî –±—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- `FILES_LIST.md` ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –î–æ–±–∞–≤–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ 409
- ‚úÖ Rate limiting (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π (30 –º–∏–Ω)
- ‚úÖ OpenAI retry (3 –ø–æ–ø—ã—Ç–∫–∏)
- ‚úÖ –ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ—è—Ö
- ‚úÖ Health check (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)
- ‚úÖ Graceful shutdown

---

**üéâ –í–°–ï –§–ê–ô–õ–´ –ì–û–¢–û–í–´ –ö –ö–û–ü–ò–†–û–í–ê–ù–ò–Æ!**

