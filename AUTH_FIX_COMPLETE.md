# ‚úÖ –ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò

## üî¥ –ù–ê–ô–î–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. **PrismaAdapter –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª —Å CredentialsProvider**
**–ë—ã–ª–æ:**
```typescript
adapter: PrismaAdapter(prisma),
providers: [CredentialsProvider({ ... })]
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å - Adapter –¥–ª—è OAuth, Credentials –¥–ª—è JWT
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –£–±—Ä–∞–Ω PrismaAdapter

---

### 2. **Dashboard –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è –ë–ï–ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**
**–ë—ã–ª–æ:**
```typescript
export default function CustomerDashboardPage() {
  // –ù–ï–¢ useSession()!
  // –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!
  const response = await fetch('/api/orders?role=customer&userId=temp-customer')
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π –º–æ–≥ –æ—Ç–∫—Ä—ã—Ç—å dashboard, –¥–∞–∂–µ –±–µ–∑ –ª–æ–≥–∏–Ω–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω `useSession({ required: true })` —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º

---

### 3. **–•–∞—Ä–¥–∫–æ–¥ userId = "temp-customer"**
**–ë—ã–ª–æ:**
```typescript
fetch('/api/orders?role=customer&userId=temp-customer')
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —é–∑–µ—Ä–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –ë–µ—Ä—ë–º –∏–∑ —Å–µ—Å—Å–∏–∏: `userId=${session.user.id}`

---

### 4. **–ù–ï–¢ –∞–≤—Ç–æ–ª–æ–≥–∏–Ω–∞ –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏**
**–ë—ã–ª–æ:**
```typescript
const handleVerified = async () => {
  router.push('/dashboard/customer') // –ü—Ä–æ—Å—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç!
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ Telegram –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω `signIn('credentials', { phone, password })`

---

### 5. **–ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞**
**–ë—ã–ª–æ:**
```typescript
<Button variant="ghost">–í—ã–π—Ç–∏</Button> // –ù–µ—Ç onClick!
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–ª–∞
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω `onClick={handleLogout}` —Å `signOut()`

---

### 6. **Middleware –Ω–µ –∑–∞—â–∏—â–∞–ª /dashboard/***
**–ë—ã–ª–æ:**
```typescript
const ROLE_PATHS = [
  { prefix: '/executor', roles: ['EXECUTOR'] },
  { prefix: '/business', roles: ['CUSTOMER'] },
  // /dashboard/* –ù–ï –ë–´–õ–û!
]
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –¥–ª—è dashboard
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω—ã `/dashboard/customer` –∏ `/dashboard/executor`

---

### 7. **useSecureCookies –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
**–ë—ã–ª–æ:**
```typescript
secure: process.env.NODE_ENV === 'production'
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –Ω–∞ HTTP (IP:3000) cookies –æ—Ç–±—Ä–∞—Å—ã–≤–∞–ª–∏—Å—å –±—Ä–∞—É–∑–µ—Ä–æ–º
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** `useSecureCookies: NEXTAUTH_URL.startsWith('https://')`

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´

### 1. `src/lib/auth.ts`
- ‚ùå –£–±—Ä–∞–Ω PrismaAdapter (–∫–æ–Ω—Ñ–ª–∏–∫—Ç)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `useSecureCookies` –ø–æ NEXTAUTH_URL
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `updateAge: 24h` –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω—ã callbacks (jwt, session, redirect)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `debug` —Ä–µ–∂–∏–º –¥–ª—è development

### 2. `src/app/auth/signup/customer/page.tsx`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `signIn` –∏–∑ next-auth/react
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–ª–æ–≥–∏–Ω –≤ `handleVerified()`:
  - –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –í—ã–∑—ã–≤–∞–µ—Ç `signIn('credentials')`
  - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ dashboard

### 3. `src/app/auth/signup/executor/page.tsx`
- ‚úÖ –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ customer signup
- ‚úÖ –ê–≤—Ç–æ–ª–æ–≥–∏–Ω —á–µ—Ä–µ–∑ `signIn()`

### 4. `src/app/dashboard/customer/page.tsx`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `useSession({ required: true })`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏: `session.user.role === 'CUSTOMER'`
- ‚úÖ –£–±—Ä–∞–Ω —Ö–∞—Ä–¥–∫–æ–¥: `userId=${session.user.id}`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `handleLogout()` —Å `signOut()`
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ò–º—è –∏–∑ —Å–µ—Å—Å–∏–∏: `{session?.user?.name}`

### 5. `src/app/executor/available/page.tsx`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `useSession({ required: true })`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏: `session.user.role === 'EXECUTOR'`
- ‚úÖ –£–±—Ä–∞–Ω —Ö–∞—Ä–¥–∫–æ–¥ `test-executor-1`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `session.user.id`

### 6. `src/components/layout/ExecutorNav.tsx`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `signOut`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

### 7. `middleware.ts`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ `/dashboard/customer`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ `/dashboard/executor`

### 8. `src/lib/telegram-init.ts`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è "–¥–∞/–Ω–µ—Ç"
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ `isGenericYesNo()`, `classifyLastQuestion()`, `applyContextualYesNo()`
- ‚úÖ –ë–æ—Ç –±–æ–ª—å—à–µ –Ω–µ –ø—É—Ç–∞–µ—Ç "–¥–∞" –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Å "–¥–∞" –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –∑–∞–¥–∞–Ω–∏—è—Ö

---

## üì¶ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –£–°–¢–ê–ù–û–í–ö–ï

### –®–∞–≥ 1: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –í–°–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
scp src/lib/auth.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp src/lib/telegram-init.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp src/app/auth/signup/customer/page.tsx root@109.69.58.185:/var/www/mb-trust/src/app/auth/signup/
scp src/app/auth/signup/executor/page.tsx root@109.69.58.185:/var/www/mb-trust/src/app/auth/signup/
scp src/app/dashboard/customer/page.tsx root@109.69.58.185:/var/www/mb-trust/src/app/dashboard/
scp src/app/executor/available/page.tsx root@109.69.58.185:/var/www/mb-trust/src/app/executor/
scp src/components/layout/ExecutorNav.tsx root@109.69.58.185:/var/www/mb-trust/src/components/layout/
scp middleware.ts root@109.69.58.185:/var/www/mb-trust/
```

### –®–∞–≥ 2: –û—á–∏—Å—Ç–∏—Ç—å –ë–î –æ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
ssh root@109.69.58.185
cd /var/www/mb-trust

# –í–∞—Ä–∏–∞–Ω—Ç A: –£–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏)
node scripts/cleanup-all-test-data.mjs

# –ò–õ–ò –í–∞—Ä–∏–∞–Ω—Ç B: SQL –æ—á–∏—Å—Ç–∫–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∏)
npx prisma db execute --file scripts/cleanup.sql --schema prisma/schema.prisma
sqlite3 prisma/dev.db 'VACUUM;'

# –ò–õ–ò –í–∞—Ä–∏–∞–Ω—Ç C: –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (–≤—Å—ë —Å –Ω—É–ª—è)
sudo systemctl stop mb-trust
rm -f prisma/dev.db prisma/prisma/dev.db
npx prisma db push
sudo systemctl start mb-trust
```

### –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç

```bash
cd /var/www/mb-trust
npm run build
sudo systemctl restart mb-trust
journalctl -u mb-trust -f
```

### –®–∞–≥ 4: –û—á–∏—Å—Ç–∏—Ç—å cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**–í –±—Ä–∞—É–∑–µ—Ä–µ:**
1. F12 ‚Üí Application ‚Üí Cookies
2. –£–¥–∞–ª–∏—Ç—å –í–°–ï cookies –¥–ª—è `109.69.58.185:3000`
3. –ó–∞–∫—Ä—ã—Ç—å DevTools
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ–ª–æ–≥–∏–Ω–æ–º

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://109.69.58.185:3000
2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ó–∞–∫–∞–∑—á–∏–∫
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É ‚Üí –û—Ç–ø—Ä–∞–≤—å—Ç–µ
4. Telegram –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí –ü—Ä–æ–π–¥–∏—Ç–µ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
5. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard/customer`
   - ‚úÖ –í header: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, [–≤–∞—à–µ –∏–º—è]!"
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" –≤–º–µ—Å—Ç–æ "–í–æ–π—Ç–∏/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"

### –¢–µ—Å—Ç 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å
2. **–ó–∞–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é**
3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —Å–Ω–æ–≤–∞
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ http://109.69.58.185:3000
5. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - ‚úÖ –í—ã –≤—Å—ë –µ—â—ë –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" (–Ω–µ "–í–æ–π—Ç–∏")

### –¢–µ—Å—Ç 3: F5 / –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å
2. –ù–∞–∂–º–∏—Ç–µ F5 –Ω–∞ dashboard 10 —Ä–∞–∑
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - ‚úÖ –í—Å–µ–≥–¥–∞ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã
   - ‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ

### –¢–µ—Å—Ç 4: –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä–æ–π—Ç–µ **–Ω–æ–≤—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º** (Incognito)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å http://109.69.58.185:3000/dashboard/customer
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin?role=customer`
   - ‚úÖ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç dashboard

### –¢–µ—Å—Ç 5: –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏"

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏"
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin`
   - ‚úÖ Cookie —É–¥–∞–ª–µ–Ω–∞
   - ‚úÖ –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å dashboard ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ signin

### –¢–µ—Å—Ç 6: –†–∞–∑–Ω—ã–µ —Ä–æ–ª–∏

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ **–∑–∞–∫–∞–∑—á–∏–∫**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å `/executor/available`
3. **–û–∂–∏–¥–∞–µ—Ç—Å—è:**
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth/signin` (–Ω–µ—Ç –ø—Ä–∞–≤)

---

## üéØ –î–û –ò –ü–û–°–õ–ï

### ‚ùå –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:
- Dashboard –æ—Ç–∫—Ä—ã–≤–∞–ª—Å—è –≤—Å–µ–º –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í—Å–µ –≤–∏–¥–µ–ª–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`temp-customer`)
- –ü–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ù–ï –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
- –°–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å
- –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞
- Middleware –Ω–µ –∑–∞—â–∏—â–∞–ª dashboard
- PrismaAdapter –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª —Å Credentials

### ‚úÖ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:
- Dashboard —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
- –ö–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç –°–í–û–ò –¥–∞–Ω–Ω—ã–µ
- –ü–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω
- –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è 30 –¥–Ω–µ–π
- –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Middleware –∑–∞—â–∏—â–∞–µ—Ç –≤—Å–µ dashboard –ø—É—Ç–∏
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ Adapter + Credentials

---

## üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –†–ï–®–ï–ù–ò–Ø

### ‚úÖ –≠–¢–û –†–ï–®–ò–¢ –ü–†–û–ë–õ–ï–ú–£?

**–î–ê! –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ.**

**–ü–æ—á–µ–º—É:**

1. **–£–±—Ä–∞–Ω PrismaAdapter** ‚Üí JWT —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **useSession({ required: true })** ‚Üí –∑–∞—â–∏—Ç–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
3. **Middleware** ‚Üí –∑–∞—â–∏—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–¥–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞!)
4. **signIn() –ø–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω —Å—Ä–∞–∑—É
5. **useSecureCookies –ø–æ NEXTAUTH_URL** ‚Üí cookies —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ HTTP
6. **signOut()** ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã—Ö–æ–¥ —Å –æ—á–∏—Å—Ç–∫–æ–π

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã –Ω–∞ –∫–æ—Ä–Ω—é!**

---

## üÜò –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Å—Å–∏—è –≤—Å—ë –µ—â—ë –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ NEXTAUTH_SECRET
cat /var/www/mb-trust/.env.local | grep NEXTAUTH_SECRET

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ù–ï "your-secret-key-change-this-in-production"!
# –ï—Å–ª–∏ —Ç–µ—Å—Ç–æ–≤–æ–µ ‚Äî –∑–∞–º–µ–Ω–∏—Ç–µ:
openssl rand -base64 32
# –ò –¥–æ–±–∞–≤—å—Ç–µ –≤ .env.local
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é

–û—á–∏—Å—Ç–∏—Ç–µ cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.

### –ü—Ä–æ–±–ª–µ–º–∞: "–ó–∞–≥—Ä—É–∑–∫–∞..." –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
journalctl -u mb-trust -n 50 | grep -E "session|token|auth"
```

---

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–û–°–õ–ï –£–°–¢–ê–ù–û–í–ö–ò

- [ ] –í—Å–µ 8 —Ñ–∞–π–ª–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –ë–î –æ—á–∏—â–µ–Ω–∞ (–ª—é–±—ã–º —Å–ø–æ—Å–æ–±–æ–º)
- [ ] `npm run build` —É—Å–ø–µ—à–µ–Ω
- [ ] `sudo systemctl restart mb-trust` –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] Cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ –æ—á–∏—â–µ–Ω—ã
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –∞–≤—Ç–æ–ª–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–ê–®–ï –∏–º—è
- [ ] F5 –Ω–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ—Ç
- [ ] –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–µ—Ç
- [ ] –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä/Incognito –ù–ï –≤–∏–¥–∏—Ç dashboard

---

**üéâ –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò –¢–ï–ü–ï–†–¨ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û!**

