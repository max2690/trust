# üîß –§–ò–ù–ê–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. **–ü—Ä–æ–±–ª–µ–º–∞: OpenAI –ø—É—Ç–∞–ª "–¥–∞" (—Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å) —Å "–¥–∞" (–∑–∞–¥–∞–Ω–∏—è)**
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –±–æ—Ç–∞ –≤ –ø—Ä–æ–º–ø—Ç extraction, —á—Ç–æ–±—ã OpenAI –ø–æ–Ω–∏–º–∞–ª, –Ω–∞ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

**–§–∞–π–ª:** `src/lib/telegram-init.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `lastAiMessage` ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è —Ä–µ–ø–ª–∏–∫–∞ –±–æ—Ç–∞
- –ü—Ä–æ–º–ø—Ç extraction —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç: "–ü–û–°–õ–ï–î–ù–ò–ô –í–û–ü–†–û–° –ë–û–¢–ê" + "–û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø"
- –°–Ω–∏–∂–µ–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å 0.3 –¥–æ 0.2 –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ —É–∫–∞–∑–∞–Ω–∏—è: "–¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å" / "–¢–û–õ–¨–ö–û –µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è"

---

### 2. **–ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞**
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cookies –∏ secret –¥–ª—è NextAuth.

**–§–∞–π–ª:** `src/lib/auth.ts`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω `maxAge: 30 –¥–Ω–µ–π` –¥–ª—è —Å–µ—Å—Å–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω `secret: process.env.NEXTAUTH_SECRET`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã cookies —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - `httpOnly: true` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
  - `sameSite: 'lax'` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF
  - `path: '/'` ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –≤—Å—ë–º —Å–∞–π—Ç–µ
  - `secure: true` –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ (HTTPS)

---

## üì¶ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –£–°–¢–ê–ù–û–í–ö–ï

### –®–∞–≥ 1: –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
scp src/lib/telegram-init.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp src/lib/auth.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å NEXTAUTH_SECRET –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@109.69.58.185
cat /var/www/mb-trust/.env.local | grep NEXTAUTH_SECRET
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
NEXTAUTH_SECRET="your-secret-key-change-this-in-production"
```

**–ï—Å–ª–∏ –ù–ï–¢ –∏–ª–∏ –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π secret
openssl rand -base64 32

# –î–æ–±–∞–≤–∏—Ç—å –≤ .env.local
nano /var/www/mb-trust/.env.local
# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
# NEXTAUTH_SECRET="<—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è_—Å—Ç—Ä–æ–∫–∞>"
```

### –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
cd /var/www/mb-trust
npm run build
sudo systemctl restart mb-trust
journalctl -u mb-trust -f
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://109.69.58.185:3000
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
3. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –±–æ—Ç–∞
4. **–ö–æ–≥–¥–∞ –±–æ—Ç —Å–ø—Ä–æ—Å–∏—Ç "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏, —á—Ç–æ —Ç—ã —Ä–µ–∞–ª—å–Ω—ã–π —á–µ–ª–æ–≤–µ–∫"** ‚Üí –û—Ç–≤–µ—Ç—å—Ç–µ "–¥–∞"
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö:**

```bash
journalctl -u mb-trust -f | grep "Extracted data"
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
[AI] Extracted data from OpenAI: {"real":"yes"}
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
[AI] Extracted data from OpenAI: {"real":"yes","daily":true}
```

---

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏

1. –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –±–æ—Ç–µ
2. –í–∞—Å –ø–µ—Ä–µ–±—Ä–æ—Å–∏—Ç –Ω–∞ –¥–∞—à–±–æ—Ä–¥
3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** ‚Üí –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –∫–Ω–æ–ø–∫—É "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" (–∞ –Ω–µ "–í–æ–π—Ç–∏")
4. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)** ‚Üí –í—Å—ë –µ—â—ë –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
5. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ** –¥–∞—à–±–æ—Ä–¥ ‚Üí –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã
6. **–ó–∞–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–Ω–æ–≤–∞** ‚Üí –í—Å—ë –µ—â—ë –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã (30 –¥–Ω–µ–π)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
2. Application ‚Üí Cookies ‚Üí `http://109.69.58.185:3000`
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å cookie `next-auth.session-token` —Å–æ —Å—Ä–æ–∫–æ–º –∂–∏–∑–Ω–∏ 30 –¥–Ω–µ–π

---

## üìä –î–û –ò –ü–û–°–õ–ï

### ‚ùå –î–û:
1. OpenAI –ø—É—Ç–∞–ª "–¥–∞" –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å —Å "–¥–∞" –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ –∑–∞–¥–∞–Ω–∏—è
2. –°–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
3. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞–ª—Å—è

### ‚úÖ –ü–û–°–õ–ï:
1. OpenAI –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞
2. –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ 30 –¥–Ω–µ–π
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–º –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞

---

## üîç –ü–†–û–í–ï–†–ö–ê –õ–û–ì–û–í

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ AI
journalctl -u mb-trust -n 50 | grep -E "\[AI\]|Extracted"
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
[AI] –ü–û–°–õ–ï–î–ù–ò–ô –í–û–ü–†–û–° –ë–û–¢–ê: "–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?"
[AI] Extracted data from OpenAI: {"name":"–ü–µ—Ç—è –ó–∞–π—Ü–µ–≤"}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ NextAuth
journalctl -u mb-trust | grep -i "session\|auth"
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

### –ï—Å–ª–∏ NEXTAUTH_SECRET –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:

1. **–°–µ—Å—Å–∏—è –ù–ï –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è**
2. **JWT —Ç–æ–∫–µ–Ω—ã –±—É–¥—É—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏**
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç —Ä–∞–∑–ª–æ–≥–∏–Ω–∏–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã**

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `NEXTAUTH_SECRET` –≤ `.env.local`!

---

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

‚úÖ –ë–æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–≤  
‚úÖ –ù–µ –ø—É—Ç–∞–µ—Ç "–¥–∞" –Ω–∞ —Ä–∞–∑–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã  
‚úÖ –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ 30 –¥–Ω–µ–π  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã–º –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞  
‚úÖ Cookies —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ security –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏  

---

**üõ°Ô∏è –í–°–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´! –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ü–†–û–î–ê–ö–®–ù–£!**

