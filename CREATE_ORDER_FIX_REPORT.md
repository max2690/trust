# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤

**–î–∞—Ç–∞:** 15 –Ω–æ—è–±—Ä—è 2025  
**URL:** http://109.69.58.185:3000/dashboard/customer/create-order  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

---

## üî¥ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** (–ö–†–ò–¢–ò–ß–ù–û!)

**–§–∞–π–ª:** `src/app/dashboard/customer/create-order/page.tsx`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
customerId: 'temp-customer', // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥–µ—Ç –∏–∑ —Å–µ—Å—Å–∏–∏
```

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ö–∞—Ä–¥–∫–æ–¥ `'temp-customer'`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `'temp-customer'` **–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ Prisma –≤—ã–¥–∞–≤–∞–ª –æ—à–∏–±–∫—É `Foreign key constraint failed`
- –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- ‚ùå –û—à–∏–±–∫–∞ Prisma –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —Å–æ–∑–¥–∞–Ω–∏—è
- ‚ùå –õ—é–±–æ–π –º–æ–≥ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

### 2. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ API** (–ö–†–ò–¢–ò–ß–ù–û!)

**–§–∞–π–ª:** `src/app/api/images/process/route.ts:65`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
if (!imageUrl) {
({ error: '–ù–µ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã' }, { status: 400 });
}
```

- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `return NextResponse.json`
- API –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚ùå QR-–∫–æ–¥ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è

---

### 3. **–°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ API orders**

**–§–∞–π–ª:** `src/app/api/orders/route.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
if (customerId) {
  const customer = await prisma.user.findUnique({ where: { id: customerId }, select: { role: true } });
  if (!customer || customer.role !== 'CUSTOMER') {
    return NextResponse.json({ error: '–°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—á–∏–∫–∏' }, { status: 403 });
  }
}
```

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ã–ª–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π (`if (customerId)`)
- –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Fallback –Ω–∞ `'temp-customer'` –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫—É Prisma

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –ú–æ–∂–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚ùå –û—à–∏–±–∫–∏ Prisma –ø—Ä–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

---

## ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/app/dashboard/customer/create-order/page.tsx`:**

```typescript
import { useSession } from 'next-auth/react'

export default function CreateOrderPage() {
  const { data: session, status } = useSession({
    required: true,
    onUnauthenticated() {
      router.push('/auth/signin?role=customer')
    },
  })

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  useEffect(() => {
    if (status === 'authenticated' && session?.user?.role !== 'CUSTOMER') {
      alert('–¢–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—á–∏–∫–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è')
      router.push('/')
    }
  }, [status, session, router])

  // –í handleSubmit
  if (!session?.user?.id) {
    alert('–í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞')
    router.push('/auth/signin?role=customer')
    return
  }

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–π customerId
  customerId: session.user.id,
  processedImageUrl: processedImageUrl || undefined,
  qrCodeUrl: qrCodeUrl || undefined,
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ CUSTOMER)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π ID –∏–∑ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

---

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ API images/process

**–ë—ã–ª–æ:**
```typescript
if (!imageUrl) {
({ error: '–ù–µ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã' }, { status: 400 });
}
```

**–°—Ç–∞–ª–æ:**
```typescript
if (!imageUrl) {
  return NextResponse.json({ error: '–ù–µ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã' }, { status: 400 });
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ API –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ QR-–∫–æ–¥—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

---

### 3. –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ API orders

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `src/app/api/orders/route.ts`:**

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ customerId
if (!customerId) {
  return NextResponse.json({ error: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è' }, { status: 401 });
}

// –†–∞–∑—Ä–µ—à–∞–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—á–∏–∫–∞–º
const customer = await prisma.user.findUnique({ where: { id: customerId }, select: { role: true } });
if (!customer) {
  return NextResponse.json({ error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' }, { status: 404 });
}
if (customer.role !== 'CUSTOMER') {
  return NextResponse.json({ error: '–°–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—á–∏–∫–∏' }, { status: 403 });
}

// –£–±—Ä–∞–Ω fallback –Ω–∞ 'temp-customer'
customer: {
  connect: { id: customerId }
},
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–µ—Ç fallback –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üß™ **–ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**

### 1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∫–∞–∫ –∑–∞–∫–∞–∑—á–∏–∫:
```
–¢–µ–ª–µ—Ñ–æ–Ω: +79241242417 (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ)
–†–æ–ª—å: CUSTOMER
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:
```
http://109.69.58.185:3000/dashboard/customer/create-order
```

### 3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
- –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
- –û–ø–∏—Å–∞–Ω–∏–µ
- –¶–µ–ª–µ–≤–∞—è —Å—Å—ã–ª–∫–∞ (URL)
- –û–±—â–∞—è —Å—É–º–º–∞ (–º–∏–Ω–∏–º—É–º 100‚ÇΩ)
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (–†–æ—Å—Å–∏—è/–†–µ–≥–∏–æ–Ω/–ì–æ—Ä–æ–¥)
- –î–µ–¥–ª–∞–π–Ω
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (Instagram, Telegram –∏ —Ç.–¥.)
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω QR-–∫–æ–¥)

### 4. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è QR-–∫–æ–¥ –ø–æ–≤–µ—Ä—Ö
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"
- ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard/customer`

---

## üìä **–°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|-----------|----------------|-------------------|
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | ‚ùå –•–∞—Ä–¥–∫–æ–¥ 'temp-customer' | ‚úÖ –†–µ–∞–ª—å–Ω–∞—è —Å–µ—Å—Å–∏—è |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| API orders | ‚ùå –°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è | ‚úÖ –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è |
| API images/process | ‚ùå –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–ª–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ | ‚ùå –û—à–∏–±–∫–∞ Prisma | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## üéØ **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. ‚úÖ `src/app/dashboard/customer/create-order/page.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
2. ‚úÖ `src/app/api/orders/route.ts` - —É–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
3. ‚úÖ `src/app/api/images/process/route.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (—É–∂–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ)

---

## üìù **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

### –ß—Ç–æ –µ—â–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:

1. **–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å QR-–∫–æ–¥–æ–º
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –±—é–¥–∂–µ—Ç–∞:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞
3. **–ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
4. **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –∑–∞–∫–∞–∑–æ–≤
5. **–ú—É–ª—å—Ç–∏–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º —Å—Ä–∞–∑—É

---

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞! ‚úÖ**

