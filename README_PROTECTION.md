# üõ°Ô∏è –ó–ê–©–ò–¢–ê TELEGRAM –ë–û–¢–ê ‚Äî –ü–û–õ–ù–´–ô –ö–û–ú–ü–õ–ï–ö–¢

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û

–î–æ–±–∞–≤–ª–µ–Ω–∞ **–∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞** –¥–ª—è Telegram –±–æ—Ç–∞ MB-TRUST:

### ‚úÖ –ó–ê–©–ò–¢–ê –û–¢ –°–ë–û–ï–í
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫** –±–æ—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- **409 Conflict**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- **Health check** –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **Graceful shutdown** –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- **–ê–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** systemd –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞

### ‚úÖ –ó–ê–©–ò–¢–ê –û–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
- **Rate limiting**: –º–∞–∫—Å–∏–º—É–º 10 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∞–º–∞, —Ä–µ–∫–ª–∞–º—ã, –º—É—Å–æ—Ä–∞
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞**: —É–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –ø–æ—Å–ª–µ 30 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: –∫–∞–∑–∏–Ω–æ, —Ä–µ–∫–ª–∞–º–∞, –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏

### ‚úÖ –ó–ê–©–ò–¢–ê –û–¢ –û–®–ò–ë–û–ö API
- **OpenAI retry**: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- **Fallback parser**: –µ—Å–ª–∏ OpenAI –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä
- **Graceful errors**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

## üì¶ –§–ê–ô–õ–´ –î–õ–Ø –£–°–¢–ê–ù–û–í–ö–ò

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (2):
1. `src/lib/bot-launcher.ts` ‚Äî —É–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
2. `src/lib/telegram-init.ts` ‚Äî –∑–∞—â–∏—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (1):
3. `mb-trust-production.service` ‚Äî systemd unit —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (4):
4. `PROTECTION_GUIDE.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞—â–∏—Ç
5. `INSTALLATION.md` ‚Äî –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å —Ç–µ—Å—Ç–∞–º–∏
6. `QUICK_INSTALL.md` ‚Äî –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
7. `FILES_LIST.md` ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤

---

## ‚ö° –ë–´–°–¢–†–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê (5 –ú–ò–ù–£–¢)

### –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
scp src/lib/bot-launcher.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp src/lib/telegram-init.ts root@109.69.58.185:/var/www/mb-trust/src/lib/
scp mb-trust-production.service root@109.69.58.185:/tmp/
```

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å
ssh root@109.69.58.185

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ systemd unit
sudo cp /tmp/mb-trust-production.service /etc/systemd/system/mb-trust.service
sudo systemctl daemon-reload

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
cd /var/www/mb-trust
npm run build

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl restart mb-trust

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
journalctl -u mb-trust -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—Ö–∞:

–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
ü§ñ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞...
‚úÖ Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω
```

**‚úÖ –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–∞!**

**‚ùå –ï—Å–ª–∏ –ù–ï –≤–∏–¥–∏—Ç–µ:**
```bash
curl http://localhost:3000/api/health
```

---

## üìñ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### –ß–∏—Ç–∞–π—Ç–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–¥–∞—á–∏:

1. **–ë—ã—Å—Ç—Ä–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** ‚Üí `QUICK_INSTALL.md` (1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
2. **–ü–æ–¥—Ä–æ–±–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å —Ç–µ—Å—Ç–∞–º–∏** ‚Üí `INSTALLATION.md` (5 —Å—Ç—Ä–∞–Ω–∏—Ü)
3. **–ü–æ–Ω—è—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞** ‚Üí `PROTECTION_GUIDE.md` (10 —Å—Ç—Ä–∞–Ω–∏—Ü)
4. **–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Üí `FILES_LIST.md` (1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### 1. –¢–µ—Å—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:
```bash
sudo systemctl restart mb-trust && sleep 5 && journalctl -u mb-trust | grep "Telegram –±–æ—Ç"
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** "‚úÖ Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω"

---

### 2. –¢–µ—Å—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://109.69.58.185:3000
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
3. –ü—Ä–æ–π–¥–∏—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

---

### 3. –¢–µ—Å—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞:
–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É **15 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥—Ä—è–¥**

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** 
- 1-10 —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- 11-15 —Å–æ–æ–±—â–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è: "‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
journalctl -u mb-trust | grep "Rate limit –ø—Ä–µ–≤—ã—à–µ–Ω"
```

---

### 4. –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
–û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É: `aaaaaaaaaaaaaaaaaaaaaaaaa`

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** "‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω —Å–ø–∞–º (–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–∏–º–≤–æ–ª—ã)"

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
journalctl -u mb-trust | grep "–ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
```

---

### 5. –¢–µ—Å—Ç –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:
```bash
sudo pkill -9 -f "npm start"
sleep 10
systemctl status mb-trust
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:** `Active: active (running)` ‚Äî systemd –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
systemctl status mb-trust

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
journalctl -u mb-trust -f

# –¢–æ–ª—å–∫–æ –ª–æ–≥–∏ –±–æ—Ç–∞
journalctl -u mb-trust -f | grep -E "ü§ñ|BOT|SPAM|CLEANUP"
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞—â–∏—Ç—ã:
```bash
# –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ —Å–ø–∞–º
journalctl -u mb-trust | grep "Rate limit" | wc -l

# –°–∫–æ–ª—å–∫–æ —Å–µ—Å—Å–∏–π –æ—á–∏—â–µ–Ω–æ
journalctl -u mb-trust | grep "CLEANUP" | wc -l

# –°–∫–æ–ª—å–∫–æ retry OpenAI
journalctl -u mb-trust | grep "–ü–æ–ø—ã—Ç–∫–∞ 2/3" | wc -l
```

---

## üÜò –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –ü–û–ú–û–©–¨

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
curl http://localhost:3000/api/health
journalctl -u mb-trust -n 30 | grep -E "ü§ñ|‚ö†Ô∏è|‚ùå"
```

### 409 Conflict:
```bash
sudo systemctl stop mb-trust
sleep 5
sudo systemctl start mb-trust
```

### –û—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏:
```bash
sudo chown -R www-data:www-data /var/www/mb-trust/.next
sudo chmod -R 755 /var/www/mb-trust/.next
npm run build
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–û–°–õ–ï –£–°–¢–ê–ù–û–í–ö–ò

- [ ] –§–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] `npm run build` –ø—Ä–æ—à—ë–ª –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] `sudo systemctl restart mb-trust` –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å "ü§ñ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞..."
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å "‚úÖ Telegram –±–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω"
- [ ] `curl http://localhost:3000/api/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"ok":true}`
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞
- [ ] –¢–µ—Å—Ç —Å–ø–∞–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç 11-15 —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –º—É—Å–æ—Ä
- [ ] `systemctl status mb-trust` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `active (running)`

---

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
‚ùå –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
‚ùå 409 –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ  
‚ùå –°–ø–∞–º –º–æ–≥ –∑–∞–±–∏—Ç—å –±–æ—Ç–∞  
‚ùå –°–µ—Å—Å–∏–∏ –≤–∏—Å–µ–ª–∏ –≤ –ø–∞–º—è—Ç–∏ –≤–µ—á–Ω–æ  
‚ùå OpenAI –æ—à–∏–±–∫–∏ –ª–æ–º–∞–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é  
‚ùå –ó–∞–≤–∏—Å–∞–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–ª–∏ —Ä—É—á–Ω–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞  

### –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
‚úÖ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
‚úÖ 409 –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
‚úÖ –°–ø–∞–º –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (10 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω)  
‚úÖ –°—Ç–∞—Ä—ã–µ —Å–µ—Å—Å–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç  
‚úÖ OpenAI –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è gracefully  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ—è—Ö  
‚úÖ Health check –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã  

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–≥–∏:

```bash
journalctl -u mb-trust -n 200 > /tmp/mb-trust-logs.txt
systemctl status mb-trust > /tmp/mb-trust-status.txt
```

–ò –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

---

**üõ°Ô∏è –í–ê–® –ë–û–¢ –¢–ï–ü–ï–†–¨ –ó–ê–©–ò–©–Å–ù –û–¢ –í–°–ï–ì–û!**

